
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    @*<meta charset="utf-8">*@
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <meta name="keywords" content="">
    <meta name="description" content="">
    <title>用户管理</title>
    <link type="text/css" href="~/css/main.css" rel="stylesheet" />
    <link href="~/css/global.css" rel="stylesheet" />
    <link type="text/css" href="~/layui/css/layui.css" rel="stylesheet" />
    <link type="text/css" href="~/lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link type="text/css" href="~/css/table.css" rel="stylesheet" />

    @*<link type="text/css" href="~/css/sccl.css" rel="stylesheet" />
        <link type="text/css" rel="stylesheet" href="~/skin/qingxin/skin.css" id="layout-skin" />*@
</head>
<body>
    <div class="admin-main">
        <blockquote class="layui-elem-quote">
            <a href="javascript:;" class="layui-btn layui-btn-small" id="add">
                <i class="fa fa-plus" aria-hidden="true"></i> 添加信息
            </a>
            <a href="#" class="layui-btn layui-btn-small" id="delete">
                <i class="fa fa-minus-circle" aria-hidden="true"></i> 删除信息
            </a>
            <a href="#" class="layui-btn layui-btn-small">
                <i class="fa fa-shopping-cart" aria-hidden="true"></i> 导出信息
            </a>
            <a href="javascript:;" class="layui-btn layui-btn-small" id="search">
                <i class="fa fa-search" aria-hidden="true"></i> 搜索
            </a>
        </blockquote>
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 15px;">
            <legend>数据列表</legend>
        </fieldset>
        <div class="layui-field-box">
            <table id="users" class="layui-table site-table table-hover">
                <thead>
                    <tr>
                        <th><input type="checkbox" id="selected-all"></th>
                        <th>用户名</th>
                        <th>真实姓名</th>
                        <th>添加时间</th>
                        <th>添加人员</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
        <div class="admin-table-page">
            <div id="pagediv" class="page"></div>
        </div>
    </div>
    <script src="~/layui/layui.js"></script>
    <script>
        var msgloading;
        var $;
        var layer;
        layui.use(['laypage', 'layer'], function () {
            //var $ = layui.jquery;
            $ = layui.jquery;
            laypage = layui.laypage;
            layer = layui.layer;
            //layer = parent.layer === undefined ? layui.layer : parent.layer;
            //$('input').iCheck({
            //    checkboxClass: 'icheckbox_flat-green'
            //});

            $('#add').on('click', function () {
                layer.open({
                    type: 2,
                    title: '新增信息',
                    content: '/sysuser/form',
                    //btn: ['保存', '取消'],
                    area: ['82%', '90%'],
                    maxmin: true,
                    //yes: function (index, layero) {
                    //    $(layero).find('iframe')[0].contentWindow.formsubmit();
                    //    //监听提交
                    //    //form.on('submit(demo1)', function (data) {
                    //    //    layer.alert(JSON.stringify(data.field), {
                    //    //        title: '最终的提交信息'
                    //    //    })
                    //    //    return false;
                    //    //});
                    //},
                    //btn2:function(index) {
                    //    layer.close(index);
                    //},
                    full: function (elem) {
                        var win = window.top === window.self ? window : parent.window;
                        $(win).on('resize',
                            function () {
                                var $this = $(this);
                                elem.width($this.width()).height($this.height()).css({
                                    top: 0,
                                    left: 0
                                });
                                elem.children('div.layui-layer-content').height($this.height() - 95);
                            });
                    },
                    end: function () {
                        bindGird();
                    }
                });
            });

            $('#search').on('click', function () {
                layer.alert('你点击了搜索按钮');
            });

            /***初始化***/
            bindGird();

            function bindGird(obj) {
                $.ajax({
                    url: '/sysuser/getusers',
                    data: { 'page': obj == null ? 1 : obj.curr },
                    cache: false,
                    beforeSend: function () {
                        msgloading = layer.msg('正在加载数据...', {
                            icon: 16,
                            shade: 0.01
                        });
                    },
                    complete: function () {
                        layer.close(msgloading);
                    },
                    success: function (res) {
                        if (res.Items) {
                            if (res.Items.length > 0) {
                                var reshtml = '';
                                for (var i = 0; i < res.Items.length; i++) {
                                    var d = '<tr>';
                                    d += '<td><input type="checkbox" id="' + res.Items[i].UserId + '"></td>';
                                    d += '<td>' + res.Items[i].UserName + '</td>';
                                    d += '<td>' + res.Items[i].RealName + '</td>';
                                    d += '<td>' + res.Items[i].CreateTime + '</td>';
                                    d += '<td>' + res.Items[i].CreateUser + '</td>';
                                    d += '<td>' +
                                        '<a href="javascript:void(0);" target="_blank" class="layui-btn layui-btn-normal layui-btn-mini">预览</a> ' +
                                        '<a href="javascript:void(0);" class="layui-btn layui-btn-mini" onclick="showEdit(\'编辑信息 - (' + res.Items[i].RealName + ')\',\'' + res.Items[i].UserId + '\')">编辑</a> ' +
                                        '<a href="javascript:;" data-id="1" data-opt="del" class="layui-btn layui-btn-danger layui-btn-mini">删除</a></td>';
                                    d += '</tr>';
                                    reshtml += d;
                                }
                                $('#users tbody').html('');
                                $('#users tbody').append(reshtml);
                            }
                        }
                        laypage({
                            cont: 'pagediv',
                            pages: res.TotalPageCount, //总页数
                            curr: res.CurrentPage, //当前页
                            groups: 5, //连续显示分页数
                            jump: function (obj, first) {
                                //var curr = obj.curr;
                                if (!first) {
                                    bindGird(obj);
                                }
                            }
                        });
                    },
                    error: function (msg) {
                        console.log(msg);
                    }
                });
            }
        });

        function showEdit(title, key) {
            layer.open({
                type: 2,
                title: title,
                content: '/sysuser/form?key=' + key,
                area: ['82%', '90%'],
                maxmin: true
            });
        }
    </script>
</body>
</html>
